TCP协议
位于传输层， 提供可靠的字节流服务。所谓的字节流服务（Byte Stream Service） 是指， 为了方便传输， 将大块数据分割成以报文段（segment） 为单位的数据包进行管理。 而可靠的传输服务是指， 能够把数据准确可靠地传给对方。 即TCP 协议为了更容易传送大数据才把数据分割， 而且 TCP 协议能够确认数据最终是否送达到对方。所以，TCP连接相当于两根管道（一个用于服务器到客户端，一个用于客户端到服务器），管道里面数据传输是通过字节码传输，传输是有序的，每个字节都是一个一个来传输。

TCP报文的首部最小长度是20个字节，因为每一行是32个bit，即4个字节，必须有的部分占了5行，所以至少有20个字节。

tcp的三次握手
第一次：客户端向服务器发送同步序列编号（syn），等待服务器确认。
第二次：服务器收到syn时，确认同步，然后向客户端请求同步，所以发送了syn和ack给客户端。
第三次：客户端收到服务器发送请求之后，向服务器发送回一个确认包（ack），让服务端知道可以进行连接了。

tcp的四次挥手
第一次：客户端发出连接释放报文（fin），并停止发送数据。
第二次：服务器接收到了fin报文时，并不会直接关闭，而是要等报文都发送完了才关闭，所以只会向客户端发送一个ack包
第三次：当服务器的所有报文都发送完毕后，服务端向客户端发送一个fin包。
第四次：收到服务器的fin包后，向服务器发送回一个ack包，连接断开。

如果已经建立了连接，但是客户端突然出现故障了怎么办？
TCP还设有一个保活计时器，如果服务器每收到一次客户端的请求，那么该计时器就会复位。时间通常设置为2小时，如果2小时内没有收到客户端的任何数据，那么服务器就会发送一个探测报文段，以后每隔75秒钟就发送一次，若连续发送10次都没反应，那么服务器就认为客户端出现故障，接着就关闭连接。

TCP使用滑动窗口机制来进行流量控制
建立连接时，各端分配一个缓冲区用来存储接收的数据，并将缓冲区的尺寸发送给另一端。接收方发送的确认消息中包含了自己剩余的缓冲区尺寸。剩余缓冲区空间的数量叫做窗口。其实就是建立连接的双方互相知道彼此剩余的缓冲区大小。

拥塞控制
在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏，这种情况就叫做网络拥塞。

TCP的四种拥塞控制算法
1.慢开始
拥塞窗口的初始值为1，完成第一次发送后拥塞窗口变为2，之后每完成一次就翻倍，直到大于或等于阈值。

2.拥塞避免
当拥塞窗口大于或等于阈值时，拥塞窗口呈线性增长，每次加一，直到到达发生拥塞。如果发生了网络拥塞，那么阈值就变为拥塞值的一半。

3.快重传
接收方成功的接受了发送方发来的M1,M2并且分别发送了ACK，现在接收方没有收到M3，而收到了M4，显然接收方不能确认M4，因为M4是失序的报文段。如果根据可靠性传输原理接收方什么都不做，但是按照快速重传算法，在收到M4,M5等报文段的时候，不断重复的向发送方发送M2的ACK，如果接收方一连收到三个重复的ACK，那么发送方不必等待重传计时器到期，由于发送方尽早重传未被确认的报文段。

4.快恢复
如果不使用快恢复，那么当发生网络拥塞时，拥塞窗口就会回到1重新开始慢开始与拥塞避免。但是使用快恢复，那么拥塞窗口会变为拥塞值的一半，然后直接进行拥塞避免。

UDP协议
用户数据报协议（UDP，User Datagram Protocol）为应用程序提供了一种无需建立连接就可以发送封装的 IP 数据报的方法。UDP是一种保留消息边界的简单的面向数据报的协议。UDP不提供差错纠正、队列管理、重复消除、流量控制和拥塞控制，但提供差错检测（包含我们在传输层中碰到的第一个真实的端到端（end-to-end）校验和）。这种协议自身提供最小功能，因此使用它的应用程序要做许多关于数据报如何发送和处理的控制工作。想要保证数据被可靠传递或正确排序，应用程序必须自己实现这些保护功能。一般来说，每个被应用程序请求的UDP输出操作只产生一个UDP数据报，从而发送一个IP数据报。而对于面向数据流的传输层协议（例如TCP），应用程序写入的全部数据与真正在单个IP数据报里传送的或接收方接收的内容可能没有联系。

UDP 的主要特点
1.UDP 是无连接的，即发送数据之前不需要建立连接，因此减少了开销和发送数据之前的时延。
2.UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的连接状态表。
3.UDP 是面向报文的。发送方的UDP对应用程序交下来的报文，在添加首部后就向下交付IP层。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。因此，应用程序必须选择合适大小的报文。
4.UDP 没有拥塞控制，因此网络出现的拥塞不会使源主机的发送速率降低。很多的实时应用（如IP电话、实时视频会议等）要去源主机以恒定的速率发送数据，并且允许在网络发生拥塞时丢失一些数据，但却不允许数据有太多的时延。UDP正好符合这种要求。
5.UDP 支持一对一、一对多、多对一和多对多的交互通信。
6.UDP 的首部开销小，只有8个字节，比TCP的20个字节的首部要短。

UDP 校验和
UDP 校验和是一个端到端的传输层校验和，是对包含了IP头部中的源（Source）和目的IP地址（Destination Address）字段的 UDP 伪首部计算得到的。它由初始的发送方计算得到，由最终的目的方校验。

伪首部
伪首部是一个虚拟的数据结构，其中的信息是从数据报所在IP分组头的分组头中提取的，既不向下传送也不向上递交，而仅仅是为计算校验和。伪头部的目的是让UDP层验证数据是否已经到达正确的目的地。

UDP 校验和计算方法
对发送方的 UDP 报文段的所有 16 bit的字的和进行反码运算，当求和遇见溢出的时候，进行回卷（将多出来的第17位与后16位相加），得到的结果放在 UDP 报文段中的检验和字段。在接收方中，将全部16bit的字（包含了校验和）加在一起，没有差错的话，就是 1111 1111 1111 1111

tcp与udp的区别
1.udp是无连接，tcp是面向连接。
2.udp的传输不可靠，不使用流量控制与拥塞控制，tcp传输可靠，使用流量控制与拥塞控制。
3.udp支持一对一，一对多，多对一和多对多交互通信，tcp只支持一对一通信。
4.udp面向报文，tcp面向字节流。








